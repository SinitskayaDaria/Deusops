# Используем официальный Node.js образ для сборки 
FROM node:23-alpine AS build

# Устанавливаем рабочую директорию внутри контейнера
WORKDIR /app

# Копируем package.json и package-lock.json для установки зависимостей
COPY package*.json ./

# Устанавливаем зависимости проекта
RUN npm install

# Копируем публичные файлы 
COPY public public

# Копируем исходный код фронтенда 
COPY src src

# Копируем файл переменных окружения
COPY .env .

# Создаём нового непривилегированного пользователя и передаём ему права на рабочую директорию
RUN adduser -D new_user && \
    chown -R new_user:new_user /app

# Запускаем контейнер от имени созданного пользователя 
USER new_user

# Открываем порт 3000 
EXPOSE 3000

# Устанавливаем команду запуска по умолчанию — запуск dev-сервера через npm
CMD ["npm", "start"]
